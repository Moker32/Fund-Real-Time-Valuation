# 全球指数数据源研究报告

## 研究日期
2026-02-13

## 调研目标
寻找延迟最小的全球指数数据源，特别是解决日经225等市场延迟过高的问题。

## 测试的数据源

### 1. Yahoo Finance (yfinance)
- **支持**: A股、港股、日经、美股、欧洲
- **延迟**: 15-30分钟（非交易时段显示昨日收盘价）
- **状态**: 可用但有延迟

### 2. 腾讯财经 (qt.gtimg.cn)
- **支持**: A股、港股、美股
- **延迟**: 实时
- **状态**: ✅ 推荐

代码格式:
- A股: `s_sh000001`, `s_sz399001`
- 港股: `hkHSI`, `hkHSCEI`
- 美股: `usDJI`, `usIXIC`, `usINX`

### 3. 东方财富 (eastmoney.com)
- **支持**: A股指数
- **延迟**: 实时
- **状态**: ❌ 当前网络环境无法访问

### 4. 百度股票通 (pae.baidu.com)
- **支持**: 全球指数
- **延迟**: 实时
- **状态**: ❌ 返回403错误

### 5. AKShare
- **支持**: 主要为历史数据
- **延迟**: 无实时API
- **状态**: ❌ 不适用

### 6. fund123
- **支持**: 仅基金数据
- **状态**: ❌ 不适用

## 最终混合数据源方案

| 市场 | 数据源 | 延迟 | 状态 |
|------|--------|------|------|
| **A股指数** | 腾讯财经 | 实时 | ✅ |
| **港股指数** | 腾讯财经 | 实时 | ✅ |
| **美股指数** | 腾讯财经 | 实时 | ✅ |
| **日经225** | yfinance | ~15分钟 | ⚠️ |
| **欧洲指数** | yfinance | 收盘价 | ⚠️ |

## 腾讯财经 API 详解

### 请求格式
```
https://qt.gtimg.cn/q={code}
```

### A股指数代码
| 指数 | 代码 |
|------|------|
| 上证指数 | s_sh000001 |
| 深证成指 | s_sz399001 |
| 创业板指 | s_sz399006 |
| 沪深300 | s_sh000300 |
| 上证50 | s_sh000016 |
| 科创50 | s_sh000688 |
| 中证500 | s_sh000905 |
| 中证1000 | s_sh000852 |

### 港股指数代码
| 指数 | 代码 |
|------|------|
| 恒生指数 | hkHSI |
| 恒生国企 | hkHSCEI |
| 恒生红筹 | hkHSCCI |

### 美股指数代码
| 指数 | 代码 |
|------|------|
| 道琼斯 | usDJI |
| 纳斯达克 | usIXIC |
| 标普500 | usINX |

### 数据返回格式
```
v_s_sh000001="1~上证指数~000001~4134.01~-0.01~-0.00~0~0~~674981.14~ZS~";
```

字段说明:
- 0: 市场编号
- 1: 名称
- 2: 代码
- 3: 当前价
- 4: 涨跌
- 5: 涨跌幅%
- 6: 成交量
- 7: 成交额

## 性能对比

| 数据源 | A股 | 港股 | 日经 | 美股 |
|--------|-----|------|------|------|
| 腾讯财经 | 136ms | 实时 | - | 实时 |
| yfinance | 延迟 | 延迟 | 15分钟 | 盘后 |

## 实现说明

在 `src/datasources/index_source.py` 中:
1. 添加腾讯财经数据源类 `TencentIndexSource`
2. 根据指数类型选择数据源
3. A股/港股/美股 → 腾讯财经
4. 日经/欧洲 → yfinance
